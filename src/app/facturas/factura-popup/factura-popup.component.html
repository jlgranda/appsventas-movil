<ion-header class="ion-no-border">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-button (click)="irAPopupCancel($event)">
                <ion-icon slot="start" name="chevron-back"></ion-icon>
                Factura FAZil
            </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
            <ion-button color="primary" (click)="addFactura($event)"
                        [disabled]="!product || !subjectCustomer || (!factura.importeTotal || factura.importeTotal <= 0)">
                <ion-icon slot="end" name="paper-plane"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true" class="ion-padding">
    <ion-grid>
        <ion-row>
            <ion-col size="auto">
                <ion-chip outline color="medium">
                    <ion-label>Quiero facturar a</ion-label>
                </ion-chip>
            </ion-col>
            <ion-col>
                <ion-chip outline color="primary" (click)="irAPopupContactos($event);">
                    <ion-label>{{ subjectCustomer ? subjectCustomer.customerFullName : 'Cliente...' }}</ion-label>
                    <ion-icon name="person-circle-outline"></ion-icon>
                </ion-chip>
            </ion-col>
        </ion-row>
        <ion-row *ngIf="isUnitDetail">
            <ion-col size="auto">
                <ion-chip outline color="medium">
                    <ion-label>por concepto de</ion-label>
                </ion-chip>
            </ion-col>
            <ion-col>
                <ion-chip outline color="primary" (click)="irAPopupServicios($event);">
                    <ion-label>{{ product ? product.name : 'Servicio...' }}</ion-label>
                    <ion-icon name="add-outline"></ion-icon>
                </ion-chip>
            </ion-col>
        </ion-row>
        <ion-row *ngIf="isUnitDetail">
            <ion-col size="auto">
                <ion-chip outline color="medium">
                    <ion-label>la suma de</ion-label>
                </ion-chip>
            </ion-col>
            <ion-col>
                <ion-chip outline color="primary">
                    <ion-label class="symbol">$</ion-label> 
                    <ion-input type="number" placeholder="0.00"
                               [(ngModel)]="factura.subTotal"
                               (ionChange)="registrarSubtotal($event)">
                    </ion-input>
                </ion-chip>
            </ion-col>
        </ion-row>
        <ion-row *ngIf="isUnitDetail">
            <ion-col>
                <ion-chip outline color="primary">
                    <ion-input type="text" placeholder="Detallar..."
                               [(ngModel)]="factura.description">
                    </ion-input>
                </ion-chip>
            </ion-col>
        </ion-row>
    </ion-grid>
    <ion-list *ngIf="!isUnitDetail" style="padding: 0.5rem; padding-top: 0rem;">
        <ion-list-header class="ion-no-padding">
            <ion-chip outline color="primary" (click)="irAPopupServicios($event);">
                <ion-label>Por concepto de</ion-label>
                <ion-icon name="add-outline"></ion-icon>
            </ion-chip>
        </ion-list-header>
        <ion-item *ngFor="let item of details">
            <ion-label color="medium">{{ item.quantity ? (item.quantity) : '0' }}
            </ion-label>
            <ion-label color="medium" style="font-size: smaller">{{item.product.name}}</ion-label>
            <ion-label color="medium" class="ion-text-right">
                {{ item.subtotal ? ('$ '+item.subtotal.toFixed(2)) : '$ 0.00' }}
            </ion-label>
        </ion-item>
    </ion-list>
    <ion-list>
        <ion-item>
            <ion-label color="dark">TOTAL</ion-label>
            <ion-label color="danger" style="text-align: right;">
                <strong>{{factura && factura.importeTotal ? ('$ '+factura.importeTotal.toFixed(2)) : '$ 0.00' }}</strong>
            </ion-label>
        </ion-item>
        <ion-item>
            <div>
                <ion-label color="primary" style="padding-top: 1rem">LOCAL COMERCIAL</ion-label>
                <ion-radio-group allow-empty-selection="true" name="radio-group"
                                 [value]="factura.estab"
                                 (ionChange)="radioGroupChange($event)">
                    <ion-item *ngFor="let item of listLocal" class="item-custom">
                        <ion-label>{{item.name}}</ion-label>
                        <ion-radio slot="start" color="primary"
                                   name="{{item.name}}" value="{{item.value}}" 
                                   checked="true">
                        </ion-radio>
                    </ion-item>
                </ion-radio-group>
            </div>
        </ion-item>
    </ion-list>
    <ion-button color="primary" expand="block" 
                (click)="confirmarFacturar($event);"
                [disabled]="!product || !subjectCustomer 
                || (!factura.importeTotal || factura.importeTotal <= 0)
                || !factura.estab">
        <ion-icon slot="start" name="paper-plane"></ion-icon>
        Facturar
    </ion-button>
</ion-content>